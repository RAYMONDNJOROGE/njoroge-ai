<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Njoroge A.I</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <header>
    <u>Njoroge A.I</u>
  </header>

  <div id="container">
    <h2 id="h21">
      Welcome to Njoroge A.I.<br>
      A simple A.I language model trained by yours truly for your benefit.<br>
      Please use me lightly as I am still learning and developing.
    </h2>

    <input id="question" type="text" placeholder="Type or Ask a command/Question" />
    <button onclick="askModel()" class="button1">Submit</button>
    <button onclick="startListening()" class="button2">ðŸŽ¤ Speak</button>

    <h3 id="h31">Response:</h3>
    <div id="response">Awaiting input...</div>
  </div>

 <script>
  async function askModel() {
    const question = document.getElementById("question").value;
    document.getElementById("response").textContent = "Thinking...";

    try {
      const res = await fetch("/api/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt: question })
      });

      const data = await res.text();
      document.getElementById("response").textContent = data || "No response received.";
      speakResponse();
      handleAppLaunch(data);
    } catch (err) {
      document.getElementById("response").textContent = "Error: " + err.message;
    }
  }

  // Speech to Text
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "en-US";
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  function startListening() {
    document.getElementById("response").textContent = "Listening...";
    recognition.start();
  }

  recognition.onresult = function (event) {
    const transcript = event.results[0][0].transcript;
    document.getElementById("question").value = transcript;
    askModel();
  };

  recognition.onerror = function (event) {
    document.getElementById("response").textContent = "Error: " + event.error;
  };

  // AI Voice Response
  function speakResponse() {
    const response = document.getElementById("response").textContent;
    if (!response) return;

    const utterance = new SpeechSynthesisUtterance(response);
    utterance.lang = "sw-KE";
    utterance.rate = 1;
    utterance.pitch = 1;
    utterance.volume = 1;

    speechSynthesis.speak(utterance);
  }

function handleAppLaunch(responseText) {
  const appLinks = {
    // Communication & Messaging
  "gmail": "https://mail.google.com",
  "outlook": "https://outlook.live.com",
  "whatsapp": "https://web.whatsapp.com",
  "telegram": "https://web.telegram.org",
  "messenger": "https://www.messenger.com",
  "slack": "https://slack.com/signin",

  // Browsing & Search
  "chrome": "https://www.google.com/chrome/",
  "google": "https://www.google.com",
  "bing": "https://www.bing.com",
  "duckduckgo": "https://duckduckgo.com",
  "edge": "https://www.microsoft.com/edge",

  // Productivity & Tools
  "drive": "https://drive.google.com",
  "docs": "https://docs.google.com",
  "sheets": "https://sheets.google.com",
  "calendar": "https://calendar.google.com",
  "notion": "https://www.notion.so",
  "canva": "https://www.canva.com",
  "chatgpt": "https://chat.openai.com",
  "copilot": "https://copilot.microsoft.com",
  "gemini": "https://gemini.google.com",

  // Social Media
  "facebook": "https://www.facebook.com",
  "instagram": "https://www.instagram.com",
  "tiktok": "https://www.tiktok.com",
  "threads": "https://www.threads.net",
  "snapchat": "https://web.snapchat.com",
  "x": "https://x.com",

  // Media & Entertainment
  "youtube": "https://www.youtube.com",
  "youtube music": "https://music.youtube.com",
  "spotify": "https://open.spotify.com",
  "netflix": "https://www.netflix.com",
  "prime video": "https://www.primevideo.com",
  "capcut": "https://www.capcut.com",

  // Navigation & Travel
  "maps": "https://www.google.com/maps",
  "uber": "https://m.uber.com",
  "bolt": "https://bolt.eu",
  "airbnb": "https://www.airbnb.com",

  // Shopping & Finance
  "amazon": "https://www.amazon.com",
  "temu": "https://www.temu.com",
  "shein": "https://www.shein.com",
  "paypal": "https://www.paypal.com",
  "cash app": "https://cash.app",

  // Utilities
  "meet": "https://meet.google.com",
  "weather": "https://www.weather.com",
  "files": "https://drive.google.com/drive/my-drive"
  };

  const lowerText = responseText.toLowerCase();

  for (const app in appLinks) {
    const commandMatch = new RegExp(`\\bopen(?:ing)?\\s+${app}\\b`, "i");
    if (commandMatch.test(lowerText)) {
      window.open(appLinks[app], "_blank"); // opens in a new tab
      break;
    }
  }
}
</script>
</body>
</html>