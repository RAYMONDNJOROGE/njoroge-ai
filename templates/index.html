<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Njoroge A.I</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <header>
    <u>Njoroge A.I</u>
  </header>

  <div id="container">
    <h2 id="h21">
      Welcome to Njoroge A.I.<br>
      A simple AI language model trained by yours truly for your benefit.<br>
      Please use me lightly as I am still learning and developing.
    </h2>

    <input id="question" type="text" placeholder="Type or Ask a command/Question" />
    <button onclick="askModel()" class="button1">Submit</button>
    <button onclick="startListening()" class="button2">ðŸŽ¤ Speak</button>

    <h3 id="h31">Response:</h3>
    <div id="response">Awaiting input...</div>
  </div>

 <script>
  async function askModel() {
    const question = document.getElementById("question").value;
    document.getElementById("response").textContent = "Thinking...";

    try {
      const res = await fetch("/api/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt: question })
      });

      const data = await res.text();
      document.getElementById("response").textContent = data || "No response received.";
      speakResponse();
      handleAppLaunch(data);
    } catch (err) {
      document.getElementById("response").textContent = "Error: " + err.message;
    }
  }

  // Speech to Text
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "en-US";
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  function startListening() {
    document.getElementById("response").textContent = "Listening...";
    recognition.start();
  }

  recognition.onresult = function (event) {
    const transcript = event.results[0][0].transcript;
    document.getElementById("question").value = transcript;
    askModel();
  };

  recognition.onerror = function (event) {
    document.getElementById("response").textContent = "Error: " + event.error;
  };

  // AI Voice Response
  function speakResponse() {
    const response = document.getElementById("response").textContent;
    if (!response) return;

    const utterance = new SpeechSynthesisUtterance(response);
    utterance.lang = "en-US";
    utterance.rate = 1;
    utterance.pitch = 1;
    utterance.volume = 1;

    speechSynthesis.speak(utterance);
  }

  // App Launcher
  function handleAppLaunch(responseText) {
    const appLinks = {
      "gmail": "https://mail.google.com",
      "youtube": "vnd.youtube://",
      "maps": "geo:0,0?q=",
      "drive": "https://drive.google.com",
      "chrome": "googlechrome://www.google.com",
      "meet": "https://meet.google.com",
      "google": "https://www.google.com"
    };

    for (const app in appLinks) {
      if (responseText.toLowerCase().includes(`open ${app}`)) {
        // Open in a new tab where possible
        window.open(appLinks[app], "_blank");
      }
    }
  }
</script>
</body>
</html>